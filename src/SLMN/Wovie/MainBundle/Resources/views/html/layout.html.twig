{% extends "SeklMainFoundationBundle::main.html.twig" %}
{% import "SLMNWovieMainBundle::html/macros.html.twig" as wovie %}

{% block header %}
    {# TODO: <link rel="icon" href="favicon.ico" type="image/x-icon"> #}
    {% stylesheets filter="?uglifycss" filter="compass"
    "@SLMNWovieMainBundle/Resources/assets/main.sass"
    output='compiled/css/main.css' %}
        <link rel="stylesheet" href="{{ asset_url }}">
    {% endstylesheets %}
{% endblock header %}

{% block templatebody %}
    <div id="root">
        <nav class="top-bar flat-nav" data-topbar>
            <ul class="title-area">
                <li class="name">
                    <h1>
                        <a href="{{ path('slmn_wovie_user_dashboard') }}">
                            WOVIE <span
                                    data-tooltip
                                    class="has-tip"
                                    title="Alpha. Based on commit {{ wovieRevision() }}."
                                    style="color: white;"
                                    >
                                α
                            </span>
                        </a>
                    </h1>
                </li>
                {% if is_granted('ROLE_USER') %}
                    <li class="toggle-topbar menu-icon">
                        <a href=""><span>Menu</span></a>
                    </li>
                {% endif %}
            </ul>

            <section class="top-bar-section">
                <ul class="left">
                    {% if is_granted('ROLE_USER') %}
                        <li class="has-form">
                            <form type="get" action="{{ path('slmn_wovie_user_search') }}">
                                <div class="row collapse">
                                    <div class="small-10 columns">
                                        <input
                                                class="top-bar-search"
                                                name="q"
                                                type="text"
                                                placeholder="search…"
                                                required=""
                                                {% if query is defined %}value="{{ query }}"{% endif %}
                                                >
                                    </div>
                                    <div class="small-2 columns">
                                        <button type="submit" class="button secondary postfix topbar-postfix">
                                            <i class="fa fa-search"></i>
                                        </button>
                                    </div>
                                    {#
                                    <div class="large-10 sm all-11 columns">
                                        <input type="text" name="q" placeholder="search…" {% if query is defined %}value="{{ query }}"{% endif %}>
                                    </div>
                                    <div class="large-2 small-1 columns">
                                        <button class="secondary button expand">A</button>
                                        {#
                                        <button type="submit" class="secondary button expand">
                                            <i class="fa fa-search"></i>
                                        </button>
                                    </div>
                                    #}
                             </div>
                            </form>
                        </li>
                        <li>
                            <a href="{{ path('slmn_wovie_user_movie_add') }}">
                                <ai class="fa fa-plus"></ai> Add
                            </a>
                        </li>
                        <li>
                            <a href="{{ path('slmn_wovie_user_movie_shelf') }}">
                                <i class="fa fa-list"></i> Shelf
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <i class="fa fa-clock-o"></i> History
                            </a>
                        </li>
                    {% endif %}
                </ul>
                <ul class="right">
                    {% if is_granted('ROLE_USER') %}
                        <li>
                            <a href="{{ path('logout') }}">
                                <i class="fa fa-power-off"></i> Logout
                            </a>
                        </li>
                    {% endif %}
                </ul>
            </section>
        </nav>

        <div class="row">
            <div class="large-12 columns">
                {% for flashMessage in app.session.flashbag.get('success') %}
                    <div data-alert class="alert-box success radius" style="margin-bottom: 0; margin-top: 10px;">
                        {{ flashMessage }}
                        <a href="#" class="close">&times;</a>
                    </div>
                {% endfor %}
                {% for flashMessage in app.session.flashbag.get('error') %}
                    <div data-alert class="alert-box warning radius" style="margin-bottom: 0; margin-top: 10px;">
                        {{ flashMessage }}
                        <a href="#" class="close">&times;</a>
                    </div>
                {% endfor %}
                {% for flashMessage in app.session.flashbag.get('info') %}
                    <div data-alert class="alert-box radius" style="margin-bottom: 0; margin-top: 10px;">
                        {{ flashMessage }}
                        <a href="#" class="close">&times;</a>
                    </div>
                {% endfor %}
            </div>
        </div>
        {% block body %}{% endblock body %}
        <div id="root_footer"></div>
    </div>
    <footer id="footer">
    </footer>
{% endblock templatebody %}

{% block endbody %}
    {% javascripts
    'bundles/fosjsrouting/js/router.js'
    'js/fos_js_routes.js'
    '@SLMNWovieMainBundle/Resources/assets/add.js'
    output='compiled/js/add.js' filter='?uglifyjs2'
    %}
        <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}
    {% if app.environment != 'prod'  %}
        <script src="{{ path('fos_js_routing_js', {"callback": "fos.Router.setData"}) }}"></script>
    {% endif %}

    {% if piwikUrl != null and piwikSiteId != null %}
        <script type="text/javascript">
            var _paq = _paq || [];
            _paq.push(['trackPageView']);
            _paq.push(['enableLinkTracking']);
            {% if is_granted('ROLE_USER') %}
            _paq.push(["setCustomVariable", 1, "User status", "LoggedIn", "visit"]);
            {% else %}
            _paq.push(["setCustomVariable", 1, "User status", "Anonymous", "visit"]);
            {% endif %}
            (function() {
                var u=(("https:" == document.location.protocol) ? "https" : "http") + "://{{ piwikUrl }}/";
                _paq.push(['setTrackerUrl', u+'piwik.php']);
                _paq.push(['setSiteId', {{ piwikSiteId }}]);
                var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';
                g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
            })();
        </script>
    {% endif %}
{% endblock endbody %}